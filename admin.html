<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - MzansiBuy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

<header class="top">
  <h1>Admin Panel</h1>
</header>

<!-- Admin Login -->
<div class="admin-box">
  <h2>Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<!-- Admin Panel -->
<div class="admin-panel hidden">
  <button onclick="window.location='index.html'">üè† Back to Home</button>

  <div class="add-product">
    <h3>Add Product</h3>
    <input type="text" id="pName" placeholder="Product name">
    <input type="number" id="pPrice" placeholder="Price (R)">
    <textarea id="pDesc" placeholder="Description"></textarea>
    <input type="file" id="pImage" accept="image/*">
    <button onclick="addProduct()">Add Product</button>
  </div>

  <div id="productList">
    <h3>Current Products</h3>
    <div id="productsGrid" class="grid"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-storage.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAFRoLLaeGoaPQHwTgt_frBDG90PQ03vZU",
  authDomain: "mzansibuy-da2ec.firebaseapp.com",
  projectId: "mzansibuy-da2ec",
  storageBucket: "mzansibuy-da2ec.appspot.com",
  messagingSenderId: "960056695104",
  appId: "1:960056695104:web:0aaaf222abaf0ceebe42a5",
  measurementId: "G-BZLD0M13GH"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// Admin login
function login() {
  const pass = document.getElementById("adminPass").value;
  if(pass === "1234"){  // change password here if needed
    document.querySelector(".admin-box").classList.add("hidden");
    document.querySelector(".admin-panel").classList.remove("hidden");
    loadProducts();
  } else {
    alert("‚ùå Wrong password. Please try again.");
  }
}

// Add product
async function addProduct() {
  const name = document.getElementById("pName").value;
  const price = document.getElementById("pPrice").value;
  const desc = document.getElementById("pDesc").value;
  const imageFile = document.getElementById("pImage").files[0];

  if(!name || !price || !imageFile){
    alert("‚ùå Please fill all fields and select an image.");
    return;
  }

  const imageRef = ref(storage, `products/${Date.now()}_${imageFile.name}`);
  await uploadBytes(imageRef, imageFile);
  const imageURL = await getDownloadURL(imageRef);

  await addDoc(collection(db, "products"), { name, price, desc, imageURL });
  alert("‚úÖ Product added successfully!");
  loadProducts();
}

// Load products
async function loadProducts() {
  const grid = document.getElementById("productsGrid");
  grid.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "products"));
  querySnapshot.forEach((docSnap) => {
    const p = docSnap.data();
    const card = document.createElement("div");
    card.classList.add("product-card");
    card.innerHTML = `
      <img src="${p.imageURL}" alt="${p.name}">
      <p>${p.name}</p>
      <p>R ${p.price}</p>
      <button onclick="deleteProduct('${docSnap.id}')">üóë Delete</button>
    `;
    grid.appendChild(card);
  });
}

// Delete product
async function deleteProduct(id) {
  if(confirm("Are you sure you want to delete this product?")){
    await deleteDoc(doc(db, "products", id));
    alert("‚úÖ Product deleted!");
    loadProducts();
  }
}

// Expose functions
window.login = login;
window.addProduct = addProduct;
window.deleteProduct = deleteProduct;
</script>

</body>
</html>